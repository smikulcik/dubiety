<html>
<head>
	<script src='https://code.jquery.com/jquery-3.1.1.min.js'></script>
	<script src='./js/chat.js'></script>
	<link rel="stylesheet" type="text/css" href='./css/chat.css' />
</head>
<body>
	<h1>Dubiety</h1>
	<div class='chat'></div>
	<form id=analyzer>
		<h3>Sentiment Analysis</h3>
		<input />
		<button type=submit id='analyzeBtn'>Analyze</button>
		<div id='analyzeOutput'></div>
	</form>
	<script>
		var getwsurl = function(path){
			var loc = window.location, new_uri;
			if (loc.protocol === "https:") {
				new_uri = "wss:";
			} else {
				new_uri = "ws:";
			}
			new_uri += "//" + loc.host;
			new_uri += loc.pathname + path;
			return new_uri; 	
		}
		var ws = new WebSocket(getwsurl("ws"));
		var chat = $('.chat');
		chat.Chat("Jeff Jacobs", function(msg){
			console.log("I've been triggered!!");
			ws.send(msg);
		});
		ws.onmessage = function(evt) {
			chat.Chat.receiveMsg(evt.data, "Anton");
		};

		ws.onopen = function()
		{
			ws.send("Help! I've lost contact with my ground control!!!")
		};
		
		$('#analyzer button').click(function(evt){
			evt.preventDefault();
			var input = $('#analyzer input').val();
			$.post('./analyze', {text: input}, function(res){
				$('#analyzer div').text(res);
			});
		});
	</script>
</body>
</html>
